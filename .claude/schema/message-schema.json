{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/message-schema.json",
  "title": "Message Schema",
  "description": "Schema for agent-to-agent messaging in Ralph-Recursive",
  
  "definitions": {
    "message": {
      "type": "object",
      "required": ["id", "from", "to", "timestamp", "type"],
      "properties": {
        "id": { "type": "string", "pattern": "^msg-[0-9]+$" },
        "from": { "type": "string" },
        "to": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "type": { 
          "type": "string",
          "enum": [
            "need_shared_type",
            "need_clarification", 
            "dependency_issue",
            "discovery",
            "complete",
            "proceed",
            "spec_update",
            "resolved",
            "query",
            "response",
            "blocked",
            "wake_parent"
          ]
        },
        "payload": { "type": "object" },
        "needs_response": { "type": "boolean", "default": false },
        "priority": {
          "type": "string",
          "enum": ["normal", "blocking", "urgent"],
          "default": "normal",
          "description": "blocking = child cannot proceed without response, urgent = time-sensitive"
        },
        "in_reply_to": { "type": "string" },
        "status": {
          "type": "string",
          "enum": ["pending", "delivered", "processed", "failed"],
          "default": "pending"
        }
      }
    }
  },
  
  "type": "object",
  "properties": {
    "inbox": {
      "type": "array",
      "items": { "$ref": "#/definitions/message" },
      "description": "Messages received from parent or children"
    },
    "outbox": {
      "type": "array", 
      "items": { "$ref": "#/definitions/message" },
      "description": "Messages sent to parent or children"
    },
    "pending_responses": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Message IDs awaiting response"
    },
    "wake_signals": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Message IDs that should trigger parent wake-up"
    }
  },
  "required": ["inbox", "outbox"]
}
